<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catalog â€” Dashboard (Frontend Only)</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="dashboard.css" rel="stylesheet">
</head>
<body>
    <div class="app">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidecard">
                <div class="section-title">Home</div>
                <nav class="nav">
                    <a class="nav-item active" href="#"><span class="label"><i class="fa-solid fa-gauge-high"></i>Dashboard</span></a>
                    <a class="nav-item" href="#"><span class="label"><i class="fa-solid fa-books"></i>All Books</span><span class="count">190</span></a>
                </nav>
                <div class="section-title">Libraries</div>
                <nav class="nav">
                    <a class="nav-item" href="#"><span class="label"><i class="fa-solid fa-book-open-reader"></i>Novels</span><span class="count">159</span></a>
                    <a class="nav-item" href="#"><span class="label"><i class="fa-solid fa-microchip"></i>Technology</span><span class="count">10</span></a>
                    <a class="nav-item" href="#"><span class="label"><i class="fa-solid fa-face-grin-beam"></i>Comics</span><span class="count">21</span></a>
                </nav>
            </div>
        </aside>

        <!-- Topbar -->
        <header class="topbar">
            <div class="brand" style="padding:0 6px;">
                <i class="fa-solid fa-book-open"></i>
                <div class="title">The<span class="dot">Catalog</span></div>
            </div>
            <button class="icon-btn circle" id="hamburger" aria-label="Toggle navigation"><i class="fa-solid fa-bars"></i></button>
            <div class="search">
                <i class="fa-solid fa-magnifying-glass"></i>
                <input type="text" placeholder="Title, Author, Series, Genre, or ISBN...">
                </div>
            <div class="actions">
                <button class="icon-btn circle hint" id="profileBtn" data-title="Profile"><i class="fa-regular fa-user"></i></button>
                <button class="icon-btn circle hint" id="logoutBtn" data-title="Logout"><i class="fa-solid fa-right-from-bracket"></i></button>
            </div>
            
        </header>

        <!-- Main -->
        <main class="main" id="mainArea">
            <section class="panel" id="continuePanel" style="margin-bottom:14px;">
                <div class="row-head">
                    <div class="row-title">Continue Reading</div>
                </div>
                <div class="progress-rail"><div class="progress-bar"></div></div>
                <div class="carousel" id="continueRow"></div>
            </section>

            <section class="panel" id="recentPanel">
                <div class="row-head">
                    <div class="row-title">Recently Added</div>
                </div>
                <div class="grid" id="recentGrid"></div>
            </section>
        </main>
    </div>
    <div class="backdrop" id="backdrop" hidden></div>
    <!-- Profile Modal -->
    <div class="modal-overlay" id="profileOverlay" aria-hidden="true">
        <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="profileTitle">
            <div class="modal-head">
                <div id="profileTitle">User Profile Information</div>
                <button class="close-btn" id="profileClose" aria-label="Close"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="modal-body">
                <div class="modal-section">
                    <h3 style="margin:0 0 10px 0;">User Profile</h3>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
                        <div>
                            <div style="color:var(--muted);font-size:12px;">Username</div>
                            <div id="profileUsername"></div>
                        </div>
                        <div>
                            <div style="color:var(--muted);font-size:12px;">Full Name</div>
                            <div id="profileFullname"></div>
                        </div>
                        <div style="grid-column:1/-1;">
                            <div style="color:var(--muted);font-size:12px;">Email</div>
                            <div id="profileEmail"></div>
                        </div>
                    </div>
                </div>
                <div class="divider" style="margin:14px 0;"></div>
                <div class="modal-section">
                    <h3 style="margin:0 0 10px 0;">Change Password</h3>
                    <div style="display:grid;gap:10px;">
                        <input class="formish" type="password" placeholder="Current Password" style="background:#0f161a;border:1px solid #1b2a30;border-radius:10px;padding:10px 12px;color:var(--text);" />
                        <input class="formish" type="password" placeholder="New Password (at least 6 characters)" style="background:#0f161a;border:1px solid #1b2a30;border-radius:10px;padding:10px 12px;color:var(--text);" />
                        <input class="formish" type="password" placeholder="Confirm New Password" style="background:#0f161a;border:1px solid #1b2a30;border-radius:10px;padding:10px 12px;color:var(--text);" />
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="icon-btn" style="padding:0 12px;height:36px;border-radius:10px;border-color:#236842;color:var(--text);background:#0e1a14;">
                    <i class="fa-solid fa-key"></i>
                    <span style="margin-left:8px;">Change Password</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Simple static book data (frontend only)
        const books = [
            { id: 'zen-speaks', title: 'Zen Speaks' },
            { id: 'gunsmith', title: 'The Gunsmith' },
            { id: 'blackout', title: 'Blackout' },
            { id: 'newjack', title: 'Newjack' },
            { id: '1984', title: '1984' },
            { id: 'yellow-world', title: 'The Yellow World' },
            { id: 'liberty', title: 'On Liberty' },
            { id: 'anna-karenina', title: 'Anna Karenina' }
        ];

        function createBookCard(book, idx) {
            const link = document.createElement('a');
            link.className = 'book-card';
            link.href = `dashboard.html?id=${encodeURIComponent(book.id)}`;
            link.innerHTML = `
                <span class="badge">#${(idx % 9) + 1}</span>
                <div class="cover-placeholder" aria-hidden="true">
                    <span class="cover-initial">${book.title.slice(0,1)}</span>
                </div>
                <div class="book-meta">
                    <span class="meta-dot"></span>
                    <div class="book-title">${book.title}</div>
                    <i class="fa-solid fa-ellipsis-vertical menu"></i>
                </div>`;
            // Client-side navigation with smooth transition
            link.addEventListener('click', (e) => {
                e.preventDefault();
                try { localStorage.setItem('selectedBook', JSON.stringify(book)); } catch (e) {}
                navigateTo(`?id=${encodeURIComponent(book.id)}`);
            });
            return link;
        }

        function fadeOutIn(callback){
            const main = document.getElementById('mainArea');
            main.style.opacity = '0';
            main.style.transform = 'translateY(6px)';
            setTimeout(() => {
                callback();
                main.style.opacity = '1';
                main.style.transform = 'translateY(0)';
            }, 180);
        }

        function renderDashboard(){
            const continuePanel = document.getElementById('continuePanel');
            const recentPanel = document.getElementById('recentPanel');
            const details = document.getElementById('detailsPanel');
            if (details) details.remove();
            continuePanel.style.display = '';
            recentPanel.style.display = '';

            const continueRow = document.getElementById('continueRow');
            continueRow.innerHTML = '';
            books.slice(0, 8).forEach((b, i) => continueRow.appendChild(createBookCard(b, i)));

            const recentGrid = document.getElementById('recentGrid');
            recentGrid.innerHTML = '';
            const recent = books.slice(0, 8);
            recent.forEach((b, i) => recentGrid.appendChild(createBookCard(b, i)));
        }

        function renderBookDetails(book){
            const main = document.getElementById('mainArea');
            const continuePanel = document.getElementById('continuePanel');
            const recentPanel = document.getElementById('recentPanel');
            continuePanel.style.display = 'none';
            recentPanel.style.display = 'none';

            let details = document.getElementById('detailsPanel');
            if (!details) {
                details = document.createElement('section');
                details.className = 'panel';
                details.id = 'detailsPanel';
                main.appendChild(details);
            }
            details.innerHTML = `
                <div class="row-head">
                    <div class="row-title">Book Details</div>
                </div>
                <div style="display:grid;grid-template-columns:160px 1fr;gap:16px;align-items:start;">
                    <div class="cover-placeholder"><span class="cover-initial">${book.title.slice(0,1)}</span></div>
                    <div>
                        <h2 style="margin:0 0 8px 0;">${book.title}</h2>
                        <div style="opacity:.8;">ID: ${book.id}</div>
                        <div style="margin-top:12px;opacity:.8;">This is a placeholder. Your details component can read <code>selectedBook</code> from localStorage or fetch by id.</div>
                    </div>
                </div>`;
        }

        function navigateTo(search){
            const params = new URLSearchParams(search.startsWith('?') ? search.substring(1) : search);
            const id = params.get('id');
            history.pushState({ id }, '', `${location.pathname}${search}`);
            fadeOutIn(() => {
                if (id) {
                    const match = books.find(b => b.id === id) || JSON.parse(localStorage.getItem('selectedBook') || 'null') || { id, title: id.replace(/-/g,' ') };
                    renderBookDetails(match);
                } else {
                    renderDashboard();
                }
            });
        }

        function mount() {
            // Populate profile modal with logged-in user data
            try {
                const stored = localStorage.getItem('currentUser');
                const uEl = document.getElementById('profileUsername');
                const nEl = document.getElementById('profileFullname');
                const eEl = document.getElementById('profileEmail');
                if (stored) {
                    const user = JSON.parse(stored);
                    if (uEl && user.username) uEl.textContent = user.username;
                    if (eEl && user.email) eEl.textContent = user.email;
                    if (nEl && user.fullName) nEl.textContent = user.fullName;
                } else {
                    if (uEl) uEl.textContent = '';
                    if (eEl) eEl.textContent = '';
                    if (nEl) nEl.textContent = '';
                }
            } catch (e) {}

            // Initial render (based on current URL)
            const initialParams = new URLSearchParams(window.location.search);
            const initialId = initialParams.get('id');
            if (initialId) {
                const fromList = books.find(b => b.id === initialId);
                if (fromList) renderBookDetails(fromList);
                else {
                    try {
                        const cached = JSON.parse(localStorage.getItem('selectedBook') || 'null');
                        renderBookDetails(cached && cached.id === initialId ? cached : { id: initialId, title: initialId.replace(/-/g,' ') });
                    } catch { renderBookDetails({ id: initialId, title: initialId }); }
                }
            } else {
                renderDashboard();
            }

            // Listen to back/forward
            window.addEventListener('popstate', (evt) => {
                const id = evt.state && evt.state.id ? evt.state.id : new URLSearchParams(location.search).get('id');
                fadeOutIn(() => {
                    if (id) {
                        const match = books.find(b => b.id === id) || JSON.parse(localStorage.getItem('selectedBook') || 'null') || { id, title: id.replace(/-/g,' ') };
                        renderBookDetails(match);
                    } else {
                        renderDashboard();
                    }
                });
            });

            // Make nav items clickable (demo)
            document.querySelectorAll('.nav-item').forEach(a => a.addEventListener('click', e => e.preventDefault()));

            // Hamburger toggle with smooth indicator
            const hamburger = document.getElementById('hamburger');
            const app = document.querySelector('.app');
            const backdrop = document.getElementById('backdrop');
            function closeMobile(){ document.body.classList.remove('mobile-open'); backdrop.hidden = true; hamburger.classList.remove('active'); }
            hamburger.addEventListener('click', () => {
                if (window.innerWidth <= 992) {
                    document.body.classList.toggle('mobile-open');
                    backdrop.hidden = !document.body.classList.contains('mobile-open');
                    hamburger.classList.toggle('active', document.body.classList.contains('mobile-open'));
                } else {
                    // On desktop, hide the sidebar entirely
                    app.classList.toggle('hide-sidebar');
                    hamburger.classList.toggle('active', app.classList.contains('hide-sidebar'));
                }
            });
            backdrop.addEventListener('click', closeMobile);

            // Profile modal handlers
            const overlay = document.getElementById('profileOverlay');
            const profileBtn = document.getElementById('profileBtn');
            const profileClose = document.getElementById('profileClose');
            function openProfile(){ overlay.classList.add('open'); overlay.setAttribute('aria-hidden','false'); }
            function closeProfile(){ overlay.classList.remove('open'); overlay.setAttribute('aria-hidden','true'); }
            profileBtn.addEventListener('click', openProfile);
            profileClose.addEventListener('click', closeProfile);
            overlay.addEventListener('click', (e)=>{ if(e.target === overlay) closeProfile(); });

            // Logout redirect
            document.getElementById('logoutBtn').addEventListener('click', () => {
                try { localStorage.removeItem('currentUser'); } catch(e) {}
                window.location.replace('signup.html');
            });
        }

        document.addEventListener('DOMContentLoaded', mount);
    </script>
</body>
</html>
